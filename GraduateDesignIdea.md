# GraduateDesignIdea 
# 题目：基于共享电单车的静态充电桩优化部署研究
##   继共享单车，共享汽车之后，共享运营的时代也催化了另外一种交通工具的流行，即共享电单车（Shared Ev）。国内已经出现了包括租八戒、电斑马、ebike、八点到、萌小明等一系列从事电单车租赁的公司。但是由于共享电单车主要依靠可充电电瓶维持运行，所以共享电单车的电瓶剩余能量是限制其正常工作的主要原因，这也是电单车租赁公司所面临的主要挑战。利用固定充电桩为城区中的共享电单车充电是一种合理且有效的方式，但是由于部署充电桩数量过多将占据大量城市土地资源。因此，优化城区中固定充电桩的部署位置，同时最小化所需充电桩的在共享电单车的运营中具有极其重要的现实意义。目前，在无线传感器网络中已有大量利用单个或多个静态能量源为传感器节点进行充电的研究，其能量源在二维，三维空间的优化部署是无线充电传感器网络中最核心研究问题之一。以无线传感器网络中的相关研究为基础，本次毕业设计任务即设计并实现一种针对城区共享电单车的高效合理的充电桩部署方案，该任务需要满足以下需求：
## 1）	调研相关静态能量源部署问题的研究；
## 2）	考虑将电单车投放于存在障碍的二维平面中，基于电单车的投入量，交通流量以及可行部署区域设计算法确定静态充电桩的部署区域；
## 3）	考虑充电桩具有有限能量，优化静态充电桩的部署位置与数量；
## 4）	以真实数据为输入，在MATLAB实现该充电桩优化部署方案，并进行性能分析。
## 同时，本次毕业设计还需翻译一篇与本专业相关的学术论文（不少于5000汉字）；并撰写符合中南大学信息科学与工程学院《毕业设计指导书》要求的毕业设计论文，提供程序源码及可运行的程序。

### 序号	参考资料目录
### 1	胡诚. 无线可充电传感器网络中充电规划及其可调度性研究[D]. 东南大学, 2015.
### 2	Haipeng Dai, Xiaobing Wu, et al. Minimizing the number of mobile chargers for large-scale wireless rechargeable sensor networks [J]. Computer Communications, 2014, 46: 54-65.
### 3	Guiyuan Jiang, Siew-Kei Lam, et al. Joint charging tour planning and depot positioning for wireless sensor networks using mobile chargers [J]. IEEE/ACM Transactions on Networking, 2017, 25(4): 2250-2266.
### 4	Lyes Khelladi, Djamei Djenouri, et al. Efficient on-demand multi-node charging techniques for wireless sensor networks [J]. Computer Communications, 2017, 101: 44-56.
### 5	Han G, Qian A, Jiang J, et al. A grid-based joint routing and charging algorithm for industrial wireless rechargeable sensor networks[J]. Computer Networks, 2016, 101(C):19-28.
### 6	Han G, Liu L, Jiang J, et al. Analysis of Energy-Efficient Connected Target Coverage Algorithms for Industrial Wireless Sensor Networks[J]. IEEE Transactions on Industrial Informatics, 2017, 13(1):135-143.
### 7	Dai H, Wang X, Liu A X, et al. Optimizing wireless charger placement for directional charging[C]// INFOCOM 2017 - IEEE Conference on Computer Communications, IEEE. IEEE, 2017:1-9.
### 8	Islam M M, Shareef H, Mohamed A. A review of techniques for optimal placement and sizing of electric vehicle charging stations[J]. Przegląd Elektrotechniczny, 2015, 91(8): 122-126.

### 三、毕业设计(论文)进度安排
### 阶段	工作任务内容	起止时间
### 1	查阅国内外资料，熟悉开发工具	12.20 — 1.20
### 2	方案设计	 1.21 — 3.19
### 3	仿真测试	3.20 — 4.29
### 4	完成毕业论文，准备答辩	4.30 — 5.20
### 5	论文答辩及完善	  5.21 — 6.9

#   毕业设计解决思路：
### （一） 首先完成CliquePartitioningAlgorithm分团算法，主要是解决充电桩数量问题（已解决）
### （二） 实现胡诚博士论文中对于S（充电桩）分布的算法，并多考虑是利用S的预部署还是利用S的动态部署，要看懂他的公式（待解决）
### （三） 最后考虑障碍的问题(如果存在障碍的话，可以使用A-star algorithm解决（A星算法可以用于路径导航方面）)（已解决）别人写的演示demo： http://qiao.github.io/PathFinding.js/visual/
### （四） 关于障碍的理解：并不是想象中移动充电小车的移动过程中遇到的障碍而改变路径，而是在分布静态充电桩时考虑障碍，意思是说：虽然计算出的S的分布位置在那，实际上那里是一个障碍，并不能安装充电桩，所以要考虑在其他地方安装。
### （五） 在此过程中要考虑算法选择问题，看是创建还是改进还是用原算法，可能涉及算法比较问题
### （六） 和师姐合作，考虑如何把胡诚博士论文的第五章实现
### （七） 在实现过程中得考虑一个点是：现在输入的数据，是我们随机产生的，并不是真实的数据，所以应该考虑使用开源的数据（比如：找hellobike电单车的分布数据，还有mango电单车的分布数据，每天或每个月的）
### （八） 导入实际地图，再考虑加入流量因素，做一个可视化系统。人（交通）流量因素很可能影响S的分布。
### （九） 之前是基于二维空间做的实验，后期直接在三维空间进行实现。（很有必要）

##  课程设计进度：
### 2018年11月18日：
  开始我的毕业设计，将之前做过的CliquePartitioningAlgorithm算法程序重新用python实现一次，它是毕业设计的一部分，而且是非常重要的一部分

### 2018年11月19日：
  在使用Numpy过程中完成数组的初始化，之后在实现CLiqePartitioningAlgorithm算法中大有作用。
今天看看能不能把CliquePartitioningAlgorithm算法的一部分21完成，目前文件已经能够正常读取，回去再优化，今晚尽量把算法实验完成

### 2018年11月20日：
发现python跑的程序和c++跑的程序结果不一样，发现原因竟是：Max_Common_Neighbor_num遍历顺序不一样    
  用python实现了最原始的CliquePartitioningAlgorithm问题，当Common_Neighbor最大值不唯一时，选择（合并）删除边最少的那两个节点。
  今晚回去把选择合并两个节点时删除最大度的的两个节点~

### 2018年12月7日：
看胡诚博士论文（第五章）后的想法(收获)：
MMCP（Minimize Mobile Chargers Problem）最小化MC问题
解决最少需要几个MC能完成使命
DVRP（Distance-constrainted Vehicle Routing Problem）距离约束路径问题 
DVRP问题是指：给定一个网络G=（E,V），一个站点B及一个距离约束D，求用最少数量的回路来覆盖整个网络的节点V，使得每个回路都经过B并且回路的长度不超过D（D涉及耗能，D不能太远（长）否则MC还没回到S就死亡了），还没达到一个周期前，MC到S后可以瞬间充满电，然后继续离开，给下一个节点充电。
覆盖整个网络需要几个回路，它的解主要还是体现在到底有几个回路
只考虑一个周期的情况，所以一个周期解决不了的就得增加MC的数量

### 2018年12月9日：
要解决MMCP问题：（完成截止日期为：2018年12月16日，一个星期的时间）
首先，解决TCP问题（仅解决了其中的一部分）
再实现TAP问题（未解决）
TCP问题包含：（1）回路可调度判定 （2）LKH算法实现 （3）整合代码就等于TCP问题
今天初步实现胡诚博士论文中回路可调度判定算法，目前在考虑LKH算法实现

### 2018年12月16日：
考虑如何实现LKH算法（加快进度），2018年12月21日要去中南大学参加张艺雯师姐的中期报告。（放弃使用LKH算法）

### 2018年12月22日：师姐给了个实验（从简单做起）
（1）用A星算法获取两辆电单车之间的距离
（2）将所有电单车的功率进行排序（按从小到大排序),构建回路H
（3）判断所选择的子回路是否满足充分必要条件

### 2018年12月23日：
（1）实现了A_Star算法
（2）接下来就是整合程序，然后完成师姐交给我的实验

### 2018年12月24日：
（1）找到A_Star算法的演示demo http://qiao.github.io/PathFinding.js/visual/

# 课程设计过程中遇到的问题：
### 2018年11月19日：
在使用python中调用numpy库，在数组操作时出现了n多意外
import numpy as np
NodeList = np.empty([n1,n2],int)，
### 初始化一个n1行n2列，元素为整形的二维数组
特别注意两种情况：
Node = np.empty([n,1],int)
这说明定义了一个n行的数组
如：
Node =[
[1],
[2],
[n]]
Node访问元素的时候，直接用Node[i]或者Node[i][0] 那个列的这项，可以要可以不要
NodeList = np.empty([1,n],int)
这说明定义了一个n列的数组
如：
NodeList =[
[1,2,3,4,5,6, ,, n]]
NodeList 访问元素的时候，需要用NodeList[0][i]，前面那个表示行，不可以省略
所以对NodeList进行选择排序的时候，需要这样
### 必须体现它是哪一行的，不然就是错的
def SelectSort(A):
lenght = A.shape[1]

for i in range(1, lenght - 1):
    max = i
    temp = 0
    for j in range(i + 1, lenght):
        if A[0][max] < A[0][j]:
            max = j
    temp = A[0][max]
    A[0][max] = A[0][i]
    A[0][i] = temp
return
    
 py文件里面的几个东西的解释：
 Edge_Delete[i][k] = x 表明选中i和k两个节点时，需要删除的边的数目为x
 Degree[0][i] = Degree[0][i] + EdgeList[i][j] 表示i节点的度，即每一行中1的个数
 （1）删除边的数量
 （2）找出节点的度

### 2019年3月8日：
 我先大概和你说一下你的毕设我打算让你怎么做吧
就是考虑节点四种分布形态，第一种是随机分布，随机分布就是近似于均匀分布，第二种是服从高斯分布，第三种是服从泊松分布，加入障碍物
在这三种分布特征下进行SCP部署
构建虚拟节点，然后进行团划分
算法的主题还是团划分算法
只是修改一部分，我是想着你得画这三种分布的示意图，然后把它们的热力图画出来

### 2019年3月10日：(陌生人qq聊天记录)
这样，你先做你毕设的开头一部分，我这边得整理整理思路，你先模拟出平面内分布节点，按随机分布，高斯分布，泊松分布，画出点图，然后再画出它们的热力图
我大概画了服从泊松分布的
高斯分布的形态是一簇一簇的
随机分布就是近似于均匀分布了
你的毕设就基于这三种节点分布做
然后在团划分算法上修改一下

### 2019年3月11日：
一些概率分布的知识： 
https://www.cnblogs.com/wt869054461/p/5936038.html
https://www.jianshu.com/p/f4cb3a8f6421

### 2019年3月12日：
一些热力图的知识：
https://blog.csdn.net/changzoe/article/details/78842732
https://zhuanlan.zhihu.com/p/49035741
https://www.infoq.cn/article/HO*2OAQ4285ASWz0Qc5I
http://landcareweb.com/questions/1726/shi-yong-san-dian-tu-shu-ju-zai-matplotlibzhong-sheng-cheng-re-tu
https://codeday.me/bug/20170611/21901.html

也是，我是觉得你需要在文中介绍一下高斯分布，泊松分布
大量随机分布下的节点可以看作均匀分布
你得看懂高斯分布和泊松分布的分布特征，比如受什么影响比较多
然后在障碍物空间中生成这些节点
然后再进行对这些节点的操作判断


### 2019年3月15日：
泊松分布：
numpy.random.poisson(lam=1.0, size=None)
数据分布于 lam两侧即lam为数据的对称轴，size为数据的个数
https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.random.poisson.html
正态分布(高斯分布)：
https://drivingc.com/numpy/5af94e322392ec5e4661073d
均匀分布：
https://docs.scipy.org/doc/numpy/reference/generated/numpy.random.uniform.html#numpy.random.uniform

##### 在做关于SCP实验的时候，产生的节点是不动的，它就是当前电单车停下来的地方【待充电】，考虑SCP部署在哪，
##### 需要多少个SCP【两个问题：优化SCP位置和优化SCP数量】
对于要明确知道每个节点的位置【坐标】，我觉得在后期确定SCP部署位置的时候非常有用
对于邻接矩阵的产生，目前的想法是：创建邻接矩阵(以节点的标号为索引)，给矩阵赋值0或者1，数组值 = 0表示
两个节点之间不相连，数组值 = 1表示两个节点相连；不能随机来，要按照与节点之间的距离相关
###### 关于邻接矩阵产生的解释：
该问题的实质是找到Pimportant区域内的最小充电桩数目能够保证该区域内所有共享电单车都被覆盖，本文采用复杂
度较低的团划分(Clique Partitioning Problem)进行解决。团划分问题是指找到能够划分一个图的最小团数量，每
个代表一定集合，一个团内的任意两个顶点都通过边相连。因此，我们针对Pimportant区域内共享电单车构建无向图
G(v, E)，图中每一个顶点代表Pimportant区域内共享电单车集合G中的点。【两个共享电单车的所属范围如果相交，
则在这两个点之间连上一条边】。利用团划分，原问题可以转化为在Pimportant区域内所有共享电单车所构成的无向图
上，找到能够划分该无向图的最小团数量。
###### 【两个共享电单车的所属范围如果相交，则在这两个点之间连上一条边】解释：
就是当两个点之间的实际距离在一定值范围内，就可以连上一条边，邻接矩阵中它们对应的数组值为1，否则为0

###### 对于这里提到的距离：
该距离不应该是欧几里得距离，需要用A_Star_Algorithm进行计算实际距离，因为后期加入障碍，欧几里得距离不能
代表实际情况，其不能躲避障碍。

接下来你要做的是：
(1)考虑如何在生成的节点平面中加入障碍，目前我是这样想的：先随机生成障碍区域，在生成电单车节点，有障碍的
地方不能部署电单车，与MCV的方案部署障碍的方式相同
(2)在高斯分布和泊松分布中，还要考虑的问题是：这两种分布涉及到节点群，我们需要多少个节点
群比较合理，每个节点群取多少个电单车节点比较合理，而这个问题会涉及到需要多少个SCP
(3)考虑一个问题：在高斯分布和泊松分布中到底适不适合随机产生无向图

### 2019年3月16日：
需要基于障碍物再生成无向图
这样的话你生成的无向图就不是两点直达了
需要加入虚拟节点，就比如遇到障碍物，设置虚拟节点
先生成障碍物再生成节点
就是假设那里有节点因为你有了障碍物之后任意两点之间不是直达的呢
所以设置虚拟节点使得两点之间是可达的
需要绕过

你想让它离散一些，你的参数就大一些就行了聚集一些就小一些就行
高斯分布就是和协方差矩阵有关
高斯分布的位置是和均值相关，离散度是和协方差矩阵相关
这个都是可以自己设置的

### 2019年3月17日：
节点已经在存在障碍的空间里面实现了高斯分布和泊松分布、均匀分布
有个注意事项，像高斯分布等，如果生成的节点遇到障碍，势必有一群节点遇到障碍，那么这一群节点也应该按照生成的分布那样分布
处理完这个问题，就可以利用A_Satr_Algorithm计算两点之间的距离了
考虑部署的节点在障碍的位置时该如何处理:(三种方式)
(1)整个节点群更新位置
(2)当前节点更新位置【取这种】
(3)将这些节点进行统计，随后在来一次对应的节点分布

### 2019年3月23日：
已实现在障碍空间中产生节点坐标，并且产生的坐标能够避开障碍
坐标避开障碍生成的方法是：当前坐标在障碍上产生，则当前节点的坐标将重新生成
准备利用A_Star_Algorithm计算两个点之间的实际距离【准备做的】
利用A_Star_Algorithm计算两点距离已经实现

##### 已经实现：
1、构造三种分布、并呈现在图中
2、节点避开障碍生成
3、利用A_Star_Algorithm计算节点之间的距离为实际距离，并非欧几里得距离
4、已经可以利用CliquePartitionAlgorithm进行处理

##### 需要改进的：
1、泊松分布和高斯分布的节点群得改进【目前大致分为4类，而且节点数量需为4的倍数】
2、要构建邻接矩阵时的那个距离看看选择多大合适
##### 节点生成图的过程
首先部署障碍，然后生成节点，判断该节点坐标是否越界、再判断当前节点坐标是否在障碍区域内部，若有一个判断成立，则该节点重新随机生成

##### 师姐的想法：
我之前想的是如果两点之间遇到障碍物，把障碍物当作虚拟节点，然后再构造无向图
我觉得这样是更能贴近实际
就是考虑障碍物大小
不是面积大小
我觉得不是考虑面积
这个也要分情况，如果两点是对角的，那么就是对角长，如果是临边的，那么就是边长
你这样单纯考虑只用A_Star算法的距离，其实并不是很合理
就是离我们的目标来说还是不太一样呢
两个节点在障碍物之间的位置不同，导致它们之间的距离是不一样的
有相邻，相对，对角
这样都是不一样的
所以所对应的障碍物大小也是不一样的
就是抽象把障碍物化为节点，用圆点表示
圆点的半径是不一样的
当前节点遇到这个障碍时，计算这两个节点【当前节点，虚拟节点】的距离？
然后再构建无向图
那虚拟节点在无向图中也算节点对吧？
嗯嗯，所以划分完之后还需要进行一次化简过程

### 2019年3月26日：
解决了只能输入4的倍数的节点数，稍加操作就好

### 2019年3月29日：
#### 我对师姐说的虚拟节点的想法：
主要是所有节点的都是静止的，很多事都比较好做
将所有节点两两连接，如果两两连接时，遇到障碍，则计算获
取两点之间连线与障碍区域两个交点的坐标，将两个坐标的中
心点的坐标计算出来，这个中心点坐标即为其中一个虚拟节点
的坐标，总结点数量＋1，统计距离矩阵(距离矩阵一直都在增
大，所以距离矩阵的初始化，不应该只有那么大，而应该是一
个动态变化的)，操作过程中，需要明确那些虚拟节点的标号
操作完后优化过程中就将其进行删除，并不让其显示在平面上
##### 个人觉得虚拟节点的作用：
两个节点本应该属于同一个分团，却因为障碍区域的阻挡，从
而使它们分布于不同的分团
##### 需要注意的点：
1、首先随机部署电单车节点和障碍区域
2、节点之间两两连接，检查连线是否与障碍区域相交，若相交
，则获取两个交点的坐标，计算出这两个交点的中点，即为虚
拟节点
3、已知所有节点的坐标(现实节点和虚拟节点)，使用欧几里得
或A_Star算法统计获取关于所有节点的距离矩阵，根据距离的
大小决定对应邻接矩阵的值为0或者1
4、使用分团算法进行处理，获取分团，再将分团中的虚拟节点
进行删除
5、输出的即为优化后的分团
#### 目前统计用A_Star算法是在无障碍空间的
达到预期效果，接下来需要做的是：不再把虚拟节点进行显示，分团结果直接用真
实的节点
之后就开始考虑优化问题


### 2019年3月30日：
虚拟节点保证在两个节点之间，还得保证虚拟节点到两个目标节点的距离都不能大于设定的邻接矩阵为1的距离，如果大于，则该虚拟节点不添加
可大大提高计算了
##### 已验证：如果不判断这两个距离，40个节点时，产生总节点为360个，判断后，产生的总结点数为117个
明天就可以开始使用师姐提示的给的方法进行优化了，加油啊，小伙子

### 2019年4月1日：
在最后生成的团中，对团内的一些节点进行绘圆，看观察其中每个团中重叠的区域
#### 分团的个数并不代表充电桩的个数

##### 个人想法：如果操作完团中的节点后，是否考虑两个独立的团之间是否可以共用一个充电桩？可能这里只能考虑电单车节点为1的团的情况；